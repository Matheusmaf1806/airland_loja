<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/images/favicon.svg" type="image/x-icon" />
    <title>Airland</title>

    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/lineicons.css" />
    <link rel="stylesheet" href="/assets/css/quill/bubble.css" />
    <link rel="stylesheet" href="/assets/css/quill/snow.css" />
    <link rel="stylesheet" href="/assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="/assets/css/morris.css" />
    <link rel="stylesheet" href="/assets/css/datatable.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />

    <!-- ========== CSS do Calendário (Anexo 1) ========= -->
    <link rel="stylesheet" href="/assets/css/calcom.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"
    />

    <style>
      /* Cor padrão dos links da sidebar */
      .sidebar-nav a {
        color: #5d657b;
      }
      /* Itens pai de submenu não são destacados automaticamente */
      .sidebar-nav .nav-item.nav-item-has-children > a {
        color: #5d657b;
      }
      /* Somente o link ativo (ícone e texto) será pintado em #365CF5 */
      .active-menu,
      .active-menu i,
      .active-menu svg {
        color: #365CF5 !important;
        fill: #365CF5 !important;
      }
      /* Sidebar ocupa 100vh e organiza os elementos em coluna */
      aside.sidebar-nav-wrapper {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      /* O menu expande e tem um padding-bottom para evitar sobreposição com a promo-box */
      aside.sidebar-nav-wrapper nav.sidebar-nav {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 80px;
        margin-bottom: 40px;
      }
      /* A promo-box fica no fim da sidebar */
      aside.sidebar-nav-wrapper .promo-box {
        margin-top: auto;
        margin-bottom: 1rem;
        z-index: 1000;
        object-fit: cover;
      }

      .profile-email {
        display: inline-block;
        max-width: 20ch;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .map-container {
        padding: 0 1rem;
        box-sizing: border-box;
        overflow: hidden;
      }

      .map-container #map {
        width: 100%;
        height: 400px;
      }

      /* margin-bottom no botão Selecionar Data */
      #openCalendarBtn {
        margin-bottom: 20px !important;
      }
      /* botão Exportar CSV menor */
      #exportBtn {
        padding: 0.25rem 0.5rem !important;
        font-size: 0.75rem !important;
        line-height: 1 !important;
      }
      /* Seleção de datas em duas linhas */
      .date-selector {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        margin-right: 1rem;
      }
    </style>
  </head>
  <body>
    <!-- ======== Preloader ========= -->
    <div id="preloader"><div class="spinner"></div></div>
    <!-- ======== Fim Preloader ========= -->

    <!-- ======== Sidebar Navigation ========= -->
    <aside class="sidebar-nav-wrapper">
      <div class="navbar-logo">
        <a href="/agente/painel-vendas.html">
          <img src="/assets/images/logo/logo.svg" alt="logo" />
        </a>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <!-- Painel de Vendas -->
          <li class="nav-item">
            <a href="painel-vendas.html">
              <span class="icon">…ícone…</span>
              <span class="text">Painel de Vendas</span>
            </a>
          </li>
          <!-- Vendas -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" class="collapsed" data-bs-toggle="collapse" data-bs-target="#ddmenu_2">
              <span class="icon">…ícone…</span>
              <span class="text">Vendas</span>
            </a>
            <ul id="ddmenu_2" class="collapse dropdown-nav">
              <li><a href="pedidos.html"><span class="arrow-icon">→</span> Pedidos</a></li>
              <li><a href="clientes.html"><span class="arrow-icon">→</span> Clientes</a></li>
            </ul>
          </li>
          <!-- Orçamentos -->
          <li class="nav-item">
            <a href="orcamentos.html">
              <span class="icon">…ícone…</span>
              <span class="text">Orçamentos</span>
            </a>
          </li>
          <!-- Personalize -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" data-bs-toggle="collapse" data-bs-target="#ddmenu_3">
              <span class="icon">…ícone…</span>
              <span class="text">Personalize</span>
            </a>
            <ul id="ddmenu_3" class="collapse dropdown-nav">
              <li><a href="design.html#idvisual"><span class="arrow-icon">→</span> Identidade Visual</a></li>
              <li><a href="design.html#paleta"><span class="arrow-icon">→</span> Paleta de Cores</a></li>
              <li><a href="design.html#banner"><span class="arrow-icon">→</span> Banner</a></li>
              <li><a href="design.html#footer"><span class="arrow-icon">→</span> Rodapé</a></li>
            </ul>
          </li>
          <!-- Usuários -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" data-bs-toggle="collapse" data-bs-target="#ddmenu_usuarios">
              <span class="icon">…ícone…</span>
              <span class="text">Usuários</span>
            </a>
            <ul id="ddmenu_usuarios" class="collapse dropdown-nav">
              <li><a href="createuser.html"><span class="arrow-icon">→</span> Criar acesso</a></li>
              <li><a href="users.html"><span class="arrow-icon">→</span> Gerenciar usuários</a></li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="promo-box">
        <div class="promo-icon">
          <img class="mx-auto" src="/assets/images/logo/logo-icon-big.svg" alt="Logo" />
        </div>
        <h3>Adam Joe</h3>
        <p>A Airland agradece por lhe ter como colaborador do nosso time.</p>
      </div>
    </aside>
    <div class="overlay"></div>
    <!-- ======== Fim Sidebar Navigation ========= -->

    <!-- ================= Main Wrapper e Header ================= -->
    <main class="main-wrapper">
      <header class="header">
        <div class="container-fluid">
          <div class="row">
            <!-- Menu Toggle -->
            <div class="col-lg-5 col-md-5 col-6">
              <button id="menu-toggle" class="main-btn primary-btn btn-hover">
                <i class="lni lni-chevron-left me-2"></i> Menu
              </button>
            </div>
            <!-- Notificações e Perfil -->
            <div class="col-lg-7 col-md-7 col-6">
              <div class="header-right d-flex justify-content-end align-items-center">
                <div class="notification-box d-none d-md-flex me-4">
                  <button class="dropdown-toggle" id="notification" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-bell"></i><span></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <!-- itens… -->
                  </ul>
                </div>
                <div class="profile-box">
                  <button class="dropdown-toggle bg-transparent border-0" id="profile" data-bs-toggle="dropdown">
                    <div class="profile-info d-flex align-items-center">
                      <img class="profile-image me-2" src="assets/images/profile/profile-image.png" alt="" />
                      <div>
                        <h6 class="profile-firstname">Adam Joe</h6>
                        <p class="profile-lastname">Admin</p>
                      </div>
                    </div>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li class="author-info d-flex align-items-center p-2">
                      <img class="profile-image me-2" src="assets/images/profile/profile-image.png" alt="image" />
                      <div>
                        <h4 class="profile-firstname-dropdown">Adam Joe</h4>
                        <a class="profile-email text-xs" href="#">Email@gmail.com</a>
                      </div>
                    </li>
                    <li class="divider"></li>
                    <li><a href="#"><i class="lni lni-user"></i> View Profile</a></li>
                    <li><a href="#"><i class="lni lni-alarm"></i> Notifications</a></li>
                    <li><a href="#"><i class="lni lni-inbox"></i> Messages</a></li>
                    <li><a href="#"><i class="lni lni-cog"></i> Settings</a></li>
                    <li class="divider"></li>
                    <li><a href="#"><i class="lni lni-exit"></i> Sign Out</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- ================= Fim do Header ================= -->

      <!-- ================= Seção Principal ================= -->
      <section>
        <div class="container-fluid">
          <!-- ========== title-wrapper start ========== -->
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title d-flex align-items-center flex-wrap">
                  <h2 class="mr-40">Invoice</h2>
                  <a href="#0" class="main-btn primary-btn btn-hover btn-sm">
                    <i class="lni lni-plus mr-5"></i> New Invoice
                  </a>
                </div>
              </div>
              <div class="col-md-6">
                <div class="breadcrumb-wrapper">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                      <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
                      <li class="breadcrumb-item active" aria-current="page">Invoice</li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
          <!-- ========== title-wrapper end ========== -->

          <!-- Invoice Wrapper Start -->
          <div class="invoice-wrapper">
            <div class="row">
              <div class="col-12">
                <div class="invoice-card card-style mb-30">
                  <div class="invoice-header d-flex justify-content-between flex-wrap">
                    <div class="invoice-for mb-3">
                      <h2 class="mb-10">Invoice</h2>
                      <p class="text-sm">Abaixo se encontra os detalhes do pedido</p>
                    </div>
                    <div class="invoice-logo mb-3">
                      <img id="logoImg" src="" alt="logo" />
                    </div>
                    <div class="invoice-date mb-3">
                      <p><span>Data de Pagamento:</span> <span id="dataPgto">--/--/----</span></p>
                      <p><span>ID do Pedido:</span> <span id="pedidoId">#----</span></p>
                    </div>
                  </div>

                  <div class="invoice-address d-flex justify-content-between flex-wrap mb-4">
                    <div class="address-item">
                      <h5 class="text-bold">From</h5>
                      <h1 id="clienteNome">Cliente Nome</h1>
                      <p class="text-sm"><span>Telefone:</span> <span id="clienteTel">(00) 0000-0000</span></p>
                      <p class="text-sm">
                        <span class="text-medium">Email:</span>
                        <span id="clienteEmail">email@exemplo.com</span>
                      </p>
                    </div>
                    <div class="address-item">
                      <h5 class="text-bold">To</h5>
                      <h1>Santa Gosh</h1>
                      <p class="text-sm">2972 Westheimer Rd. Santa Ana, Illinois 85486</p>
                      <p class="text-sm">
                        <span class="text-medium">Email:</span> admin@example.com
                      </p>
                    </div>
                  </div>

                  <div class="table-responsive">
                    <table class="invoice-table table">
                      <thead>
                        <tr>
                          <th class="service">
                            <h6 class="text-sm text-medium">Tipo</h6>
                          </th>
                          <th class="desc">
                            <h6 class="text-sm text-medium">Item</h6>
                          </th>
                          <th class="qty">
                            <h6 class="text-sm text-medium">Total</h6>
                          </th>
                          <th class="amount">
                            <h6 class="text-sm text-medium">Valor</h6>
                          </th>
                        </tr>
                      </thead>
                      <tbody id="itensBody">
                        <!-- itens dinamicamente inseridos -->
                      </tbody>
                      <tfoot>
                        <tr>
                          <td colspan="3"></td>
                          <td>
                            <h6 class="text-sm text-medium">Subtotal</h6>
                          </td>
                          <td>
                            <h6 class="text-sm text-bold" id="subtotalVal">R$ 0,00</h6>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="3"></td>
                          <td>
                            <h6 class="text-sm text-medium">Desconto</h6>
                          </td>
                          <td>
                            <h6 class="text-sm text-bold" id="descontoVal">0%</h6>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="3"></td>
                          <td>
                            <h6 class="text-sm text-medium">Cupom de desconto</h6>
                          </td>
                          <td>
                            <h6 class="text-sm text-bold" id="cupomVal">—</h6>
                          </td>
                        </tr>
                        <tr>
                          <td colspan="3"></td>
                          <td><h4>Total</h4></td>
                          <td><h4 class="text-bold" id="totalVal">R$ 0,00</h4></td>
                        </tr>
                      </tfoot>
                    </table>
                  </div>

                  <div class="invoice-action mt-4">
                    <ul class="d-flex flex-wrap align-items-center justify-content-center">
                      <li class="m-2">
                        <a href="#0" class="main-btn primary-btn-outline btn-hover">Download Invoice</a>
                      </li>
                      <li class="m-2">
                        <a href="#0" class="main-btn primary-btn btn-hover">Send Invoice</a>
                      </li>
                    </ul>
                  </div>
                </div>
                <!-- End Card -->
              </div>
            </div>
          </div>
          <!-- Invoice Wrapper End -->
        </div>
      </section>
      <!-- ================= Fim Seção Principal ================= -->

      <!-- ================= Footer ================= -->
      <footer class="footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6 order-last order-md-first">
              <div class="copyright text-center text-md-start">
                <p class="text-sm">
                  Designed and Developed by
                  <a href="https://Airland.com" rel="nofollow" target="_blank">Airland</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- ================= Fim Footer ================= -->
    </main>
    <!-- ================= Fim Main Wrapper ================= -->

    <!-- ============ Theme Option Start ============= -->
    <button class="option-btn"><i class="lni lni-cog"></i></button>
    <div class="option-overlay"></div>
    <div class="option-box">
      <div class="option-header">
        <h5>Settings</h5>
        <button class="option-btn-close text-gray"><i class="lni lni-close"></i></button>
      </div>
      <h6 class="mb-10">Layout</h6>
      <ul class="mb-30">
        <li><button class="leftSidebarButton active">Left Sidebar</button></li>
        <li><button class="rightSidebarButton">Right Sidebar</button></li>
      </ul>
      <h6 class="mb-10">Theme</h6>
      <ul class="d-flex flex-wrap align-items-center">
        <li><button class="lightThemeButton active">Light Theme + Sidebar 1</button></li>
        <li><button class="darkThemeButton">Dark Theme + Sidebar 1</button></li>
      </ul>
    </div>
    <!-- ============ Theme Option End ============= -->

    <!-- ========= All Javascript files linkup ======== -->
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/Chart.min.js"></script>
    <script src="/assets/js/apexcharts.min.js"></script>
    <script src="/assets/js/dynamic-pie-chart.js"></script>
    <script src="/assets/js/moment.min.js"></script>
    <script src="/assets/js/fullcalendar.js"></script>
    <script src="/assets/js/jvectormap.min.js"></script>
    <script src="/assets/js/world-merc.js"></script>
    <script src="/assets/js/polyfill.js"></script>
    <script src="/assets/js/quill.min.js"></script>
    <script src="/assets/js/datatable.js"></script>
    <script src="/assets/js/Sortable.min.js"></script>
    <script src="/assets/js/calendarComponent.global.js"></script>
    <script src="/assets/js/login.js" defer></script>
    <script src="/assets/js/userProfile.js" defer></script>
    <script src="/assets/js/main.js"></script>

    <script>
      // formata dd/mm/yyyy
      function formatDate(d) {
        const dt = new Date(d);
        return (
          String(dt.getDate()).padStart(2, "0") +
          "/" +
          String(dt.getMonth() + 1).padStart(2, "0") +
          "/" +
          dt.getFullYear()
        );
      }

      // Carrega /api/me e /api/agent/pedidos
      let logoUrl = "", pedido = null;
      Promise.all([
        fetch("/api/me").then((r) => r.json()),
        fetch("/api/agent/pedidos").then((r) => r.json())
      ]).then(([me, pedidos]) => {
        logoUrl = me.logo_url || "";
        document.getElementById("logoImg").src = logoUrl;

        // pega primeiro pedido (ou adapte)
        pedido = pedidos[0] || {};

        // preenche header
        document.getElementById("dataPgto").textContent = formatDate(pedido.data_pgto);
        document.getElementById("pedidoId").textContent = pedido.id;
        // preenche cliente
        document.getElementById("clienteNome").textContent = pedido.nome;
        document.getElementById("clienteTel").textContent = pedido.telefone;
        document.getElementById("clienteEmail").textContent = pedido.email;

        // itera itens do pedido.pedido
        const itens = JSON.parse(pedido.pedido || "[]");
        let subtotal = 0;
        const tbody = document.getElementById("itensBody");
        itens.forEach((it) => {
          const tipo = it.type;
          const item = it.hotelName + " / " + it.roomName;
          const totalQty = it.adults + it.children;
          const valor =
            it.basePriceAdult * it.adults +
            it.basePriceChild * it.children;
          subtotal += valor;
          tbody.insertAdjacentHTML(
            "beforeend",
            `<tr>
              <td><p class="text-sm">${tipo}</p></td>
              <td><p class="text-sm">${item}</p></td>
              <td><p class="text-sm">${totalQty}</p></td>
              <td><p class="text-sm">R$ ${valor.toLocaleString("pt-BR", {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
              })}</p></td>
            </tr>`
          );
        });

        // calcula desconto
        let descontoPerc = 0;
        if (pedido.meio_pgto && pedido.meio_pgto.toLowerCase() === "pix") {
          descontoPerc = 5;
        }
        const descontoVal = (subtotal * descontoPerc) / 100;
        // cupom sem alteração
        const cupomVal = 0;

        // total final
        const totalFinal = subtotal - descontoVal - cupomVal;

        // preenche rodapé
        document.getElementById("subtotalVal").textContent =
          "R$ " +
          subtotal.toLocaleString("pt-BR", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
        document.getElementById("descontoVal").textContent =
          descontoPerc + "%";
        document.getElementById("cupomVal").textContent = "—";
        document.getElementById("totalVal").textContent =
          "R$ " +
          totalFinal.toLocaleString("pt-BR", {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
          });
      });

      // Calendário
      const btnOpen = document.getElementById("openCalendarBtn");
      const selDatesEl = document.getElementById("selectedDates");
      const calEl = createCalendarComponent();
      Object.assign(calEl.style, {
        position: "absolute",
        display: "none",
        zIndex: "1000"
      });
      document.body.appendChild(calEl);
      function positionCal() {
        const r = btnOpen.getBoundingClientRect();
        calEl.style.top = r.bottom + window.scrollY + "px";
        calEl.style.left = r.left + window.scrollX + "px";
        requestAnimationFrame(() => {
          const cr = calEl.getBoundingClientRect();
          if (cr.right > window.innerWidth) {
            calEl.style.left =
              parseFloat(calEl.style.left) -
              (cr.right - window.innerWidth + 10) +
              "px";
          }
          if (cr.bottom > window.innerHeight) {
            calEl.style.top =
              parseFloat(calEl.style.top) -
              (cr.bottom - window.innerHeight + 10) +
              "px";
          }
        });
      }
      btnOpen.addEventListener("click", () => {
        if (calEl.style.display === "none") {
          positionCal();
          calEl.style.display = "block";
        } else {
          calEl.style.display = "none";
        }
      });
      document.addEventListener("click", (e) => {
        if (!calEl.contains(e.target) && e.target !== btnOpen) {
          calEl.style.display = "none";
        }
      });
      calEl
        .querySelector(".calendar__button--primary")
        .addEventListener("click", () => {
          const sel = Array.from(
            calEl.querySelectorAll(".calendar__date--selected")
          );
          if (!sel.length) return;
          const year = +calEl.querySelector("#calendar__year").value;
          const month = +calEl.querySelector("#calendar__month").value;
          const days = sel.map((d) => +d.textContent);
          const sDate = new Date(year, month, Math.min(...days));
          const eDate = new Date(year, month, Math.max(...days));
          selDatesEl.textContent =
            formatDate(sDate) + " – " + formatDate(eDate);
          calEl.style.display = "none";
        });
    </script>
  </body>
</html>
