<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/assets/images/favicon.svg" type="image/x-icon" />
    <title>Airland</title>

    <!-- ========== All CSS files linkup ========= -->
    <link rel="stylesheet" href="/assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/assets/css/lineicons.css" />
    <link rel="stylesheet" href="/assets/css/quill/bubble.css" />
    <link rel="stylesheet" href="/assets/css/quill/snow.css" />
    <link rel="stylesheet" href="/assets/css/fullcalendar.css" />
    <link rel="stylesheet" href="/assets/css/morris.css" />
    <link rel="stylesheet" href="/assets/css/datatable.css" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    
    <!-- ========== CSS do Calendário (Anexo 1) ========= -->
    <link rel="stylesheet" href="/assets/css/calcom.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css" />

    <style>
      /* Cor padrão dos links da sidebar */
      .sidebar-nav a { color: #5d657b; }
      /* Itens pai de submenu não são destacados automaticamente */
      .sidebar-nav .nav-item.nav-item-has-children > a { color: #5d657b; }
      /* Somente o link ativo (ícone e texto) será pintado em #365CF5 */
      .active-menu,
      .active-menu i,
      .active-menu svg {
        color: #365CF5 !important;
        fill: #365CF5 !important;
      }
      /* Sidebar ocupa 100vh e organiza os elementos em coluna */
      aside.sidebar-nav-wrapper {
        display: flex;
        flex-direction: column;
        height: 100vh;
      }
      /* O menu expande e tem um padding-bottom para evitar sobreposição com a promo-box */
      aside.sidebar-nav-wrapper nav.sidebar-nav {
        flex: 1;
        overflow-y: auto;
        padding-bottom: 80px;
        margin-bottom: 40px;
      }
      /* A promo-box fica no fim da sidebar */
      aside.sidebar-nav-wrapper .promo-box {
        margin-top: auto;
        margin-bottom: 1rem;
        z-index: 1000;
        object-fit: cover;
      }

      /* Trunca email no dropdown */
      .profile-email {
        display: inline-block;
        max-width: 20ch;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .map-container {
        padding: 0 1rem;
        box-sizing: border-box;
        overflow: hidden;
      }
      .map-container #map {
        width: 100%;
        height: 400px;
      }
    </style>
  </head>
  <body>
    <!-- ======== Preloader ========= -->
    <div id="preloader"><div class="spinner"></div></div>
    <!-- ======== Fim Preloader ========= -->

    <!-- ======== Sidebar Navigation ========= -->
    <aside class="sidebar-nav-wrapper">
      <div class="navbar-logo">
        <a href="/agente/painel-vendas.html">
          <img src="/assets/images/logo/logo.svg" alt="logo" />
        </a>
      </div>
      <nav class="sidebar-nav">
        <ul>
          <!-- Menu: Painel de Vendas -->
          <li class="nav-item">
            <a href="painel-vendas.html">
              <span class="icon">
                <svg width="20" height="20" …>…</svg>
              </span>
              <span class="text">Painel de Vendas</span>
            </a>
          </li>
          <!-- Menu: Vendas com submenu -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" data-bs-toggle="collapse" data-bs-target="#ddmenu_2" class="collapsed">
              <span class="icon">
                <svg width="20" height="20" …>…</svg>
              </span>
              <span class="text">Vendas</span>
            </a>
            <ul id="ddmenu_2" class="collapse dropdown-nav">
              <li><a href="pedidos.html"><span class="arrow-icon">→</span> Pedidos</a></li>
              <li><a href="clientes.html"><span class="arrow-icon">→</span> Clientes</a></li>
            </ul>
          </li>
          <!-- Menu: Orçamentos -->
          <li class="nav-item">
            <a href="orcamentos.html">
              <span class="icon">
                <svg width="20" height="20" …>…</svg>
              </span>
              <span class="text">Orçamentos</span>
            </a>
          </li>
          <!-- Menu: Personalize -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" data-bs-toggle="collapse" data-bs-target="#ddmenu_3">
              <span class="icon">
                <svg width="20" height="20" …>…</svg>
              </span>
              <span class="text">Personalize</span>
            </a>
            <ul id="ddmenu_3" class="collapsed dropdown-nav">
              <li><a href="design.html#idvisual"><span class="arrow-icon">→</span> Identidade Visual</a></li>
              <li><a href="design.html#paleta"><span class="arrow-icon">→</span> Paleta de Cores</a></li>
              <li><a href="design.html#banner"><span class="arrow-icon">→</span> Banner</a></li>
              <li><a href="design.html/#footer"><span class="arrow-icon">→</span> Rodapé</a></li>
            </ul>
          </li>
          <!-- Menu: Usuários -->
          <li class="nav-item nav-item-has-children">
            <a href="#0" data-bs-toggle="collapse" data-bs-target="#ddmenu_usuarios">
              <span class="icon">
                <svg width="20" height="20" …>…</svg>
              </span>
              <span class="text">Usuários</span>
            </a>
            <ul id="ddmenu_usuarios" class="collapsed dropdown-nav">
              <li><a href="createuser.html"><span class="arrow-icon">→</span> Criar acesso</a></li>
              <li><a href="users.html"><span class="arrow-icon">→</span> Gerenciar usuários</a></li>
            </ul>
          </li>
        </ul>
      </nav>
      <div class="promo-box">
        <div class="promo-icon">
          <img class="mx-auto" src="/assets/images/logo/logo-icon-big.svg" alt="Logo" />
        </div>
        <h3>Adam Joe</h3>
        <p>A Airland agradece por lhe ter como colaborador do nosso time.</p>
      </div>
    </aside>
    <div class="overlay"></div>
    <!-- ======== Fim Sidebar Navigation ========= -->

    <!-- ================= Main Wrapper e Header ================= -->
    <main class="main-wrapper">
      <header class="header">
        <div class="container-fluid">
          <div class="row">
            <!-- Menu Toggle -->
            <div class="col-lg-5 col-md-5 col-6">
              <div class="header-left d-flex align-items-center">
                <div class="menu-toggle-btn mr-15">
                  <button id="menu-toggle" class="main-btn primary-btn btn-hover">
                    <i class="lni lni-chevron-left me-2"></i> Menu
                  </button>
                </div>
              </div>
            </div>
            <!-- Dados do Perfil no Header -->
            <div class="col-lg-7 col-md-7 col-6">
              <div class="header-right">
                <!-- Notificações -->
                <div class="notification-box ml-15 d-none d-md-flex">
                  <button class="dropdown-toggle" id="notification" data-bs-toggle="dropdown">
                    <i class="fa-solid fa-bell"></i><span></span>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="notification">
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-6.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>John Doe <span class="text-regular">comment on a product.</span></h6>
                          <p>Lorem ipsum dolor sit amet, consect etur adipiscing elit Vivamus tortor.</p>
                          <span>10 mins ago</span>
                        </div>
                      </a>
                    </li>
                    <li>
                      <a href="#0">
                        <div class="image">
                          <img src="assets/images/lead/lead-1.png" alt="" />
                        </div>
                        <div class="content">
                          <h6>Jonathon <span class="text-regular">like on a product.</span></h6>
                          <p>Lorem ipsum dolor sit amet, consect etur adipiscing elit Vivamus tortor.</p>
                          <span>10 mins ago</span>
                        </div>
                      </a>
                    </li>
                  </ul>
                </div>
                <!-- Perfil -->
                <div class="profile-box ml-15">
                  <button class="dropdown-toggle bg-transparent border-0" id="profile" data-bs-toggle="dropdown">
                    <div class="profile-info">
                      <div class="info">
                        <div class="image">
                          <img class="profile-image" src="assets/images/profile/profile-image.png" alt="" />
                        </div>
                        <div>
                          <h6 class="profile-firstname">Adam Joe</h6>
                          <p class="profile-lastname">Admin</p>
                        </div>
                      </div>
                    </div>
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="profile">
                    <li>
                      <div class="author-info flex items-center !p-1">
                        <div class="image">
                          <img class="profile-image" src="assets/images/profile/profile-image.png" alt="" />
                        </div>
                        <div class="content">
                          <h4 class="profile-firstname-dropdown">Adam Joe</h4>
                          <a class="profile-email text-black/40 hover:text-black text-xs" href="#">
                            Email@gmail.com
                          </a>
                        </div>
                      </div>
                    </li>
                    <li class="divider"></li>
                    <li><a href="#0"><i class="lni lni-user"></i> View Profile</a></li>
                    <li><a href="#0"><i class="lni lni-alarm"></i> Notifications</a></li>
                    <li><a href="#0"><i class="lni lni-inbox"></i> Messages</a></li>
                    <li><a href="#0"><i class="lni lni-cog"></i> Settings</a></li>
                    <li class="divider"></li>
                    <li><a href="#0"><i class="lni lni-exit"></i> Sign Out</a></li>
                  </ul>
                </div>
                <!-- Fim do Perfil -->
              </div>
            </div>
          </div>
        </div>
      </header>
      <!-- ================= Fim do Header ================= -->

      <!-- ================= Seção Principal (Invoice) ================= -->
      <section class="section">
        <div class="container-fluid">
          <!-- ===== Title Wrapper ===== -->
          <div class="title-wrapper pt-30">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="title d-flex align-items-center flex-wrap">
                  <h2 class="mr-40">Invoice</h2>
                  <a href="#0" class="main-btn primary-btn btn-hover btn-sm">
                    <i class="lni lni-plus mr-5"></i> New Invoice
                  </a>
                </div>
              </div>
              <div class="col-md-6">
                <div class="breadcrumb-wrapper">
                  <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                      <li class="breadcrumb-item"><a href="#0">Dashboard</a></li>
                      <li class="breadcrumb-item active" aria-current="page">Invoice</li>
                    </ol>
                  </nav>
                </div>
              </div>
            </div>
          </div>
          <!-- ===== Invoice Wrapper ===== -->
          <div class="invoice-wrapper">
            <div class="row">
              <div class="col-12">
                <div class="invoice-card card-style mb-30">
                  <div class="invoice-header d-flex justify-content-between flex-wrap">
                    <div class="invoice-for">
                      <h2 class="mb-10">Abaixo se encontra os detalhes do pedido</h2>
                    </div>
                    <div class="invoice-logo">
                      <img id="invoiceLogo" src="/assets/images/logo/logo.svg" alt="Logo" />
                    </div>
                    <div class="invoice-date">
                      <p><span>Data de Pagamento:</span> <span id="dataPagamento">--/--/----</span></p>
                      <p><span>ID do Pedido:</span> <span id="idPedido">#----</span></p>
                    </div>
                  </div>
                  <div class="invoice-address d-flex justify-content-between flex-wrap">
                    <div class="address-item">
                      <h5 class="text-bold">Para</h5>
                      <h1 id="clienteNome">Cliente Nome</h1>
                      <p class="text-sm">
                        <span class="text-medium">Telefone:</span>
                        <span id="clienteTelefone">(00) 00000‑0000</span>
                      </p>
                      <p class="text-sm">
                        <span class="text-medium">Email:</span>
                        <span id="clienteEmail">email@exemplo.com</span>
                      </p>
                    </div>
                  </div>
                  <div class="table-responsive">
                    <table class="invoice-table table">
                      <thead>
                        <tr>
                          <th class="service"><h6 class="text-sm text-medium">Tipo</h6></th>
                          <th class="desc"><h6 class="text-sm text-medium">Item</h6></th>
                          <th class="qty"><h6 class="text-sm text-medium">Total</h6></th>
                          <th class="amount"><h6 class="text-sm text-medium">Valor</h6></th>
                        </tr>
                      </thead>
                      <tbody id="invoiceTableBody">
                        <!-- linhas serão preenchidas via JS -->
                      </tbody>
                      <tfoot id="invoiceSummary">
                        <!-- subtotal, desconto, cupom, total via JS -->
                      </tfoot>
                    </table>
                  </div>
                  <div class="note-wrapper warning-alert py-4 px-sm-3 px-lg-5">
                    <div class="alert">
                      <h5 class="text-bold mb-15">Notes:</h5>
                      <p class="text-sm text-gray">
                        All accounts are to be paid within 7 days from receipt
                        of invoice. To be paid by cheque or credit card or
                        direct payment online. If account is not paid within 7
                        days the credits details supplied as confirmation of
                        work undertaken will be charged the agreed quoted fee
                        noted above.
                      </p>
                    </div>
                  </div>
                  <div class="invoice-action">
                    <ul class="d-flex flex-wrap align-items-center justify-content-center">
                      <li class="m-2">
                        <a href="#0" class="main-btn primary-btn-outline btn-hover">
                          Download Invoice
                        </a>
                      </li>
                      <li class="m-2">
                        <a href="#0" class="main-btn primary-btn btn-hover">
                          Send Invoice
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
                <!-- End Card -->
              </div>
            </div>
          </div>
        </div>
      </section>
      <!-- ================= Fim Seção Principal ================= -->

      <!-- ================= Footer ================= -->
      <footer class="footer">
        <div class="container-fluid">
          <div class="row">
            <div class="col-md-6 order-last order-md-first">
              <div class="copyright text-center text-md-start">
                <p class="text-sm">
                  Designed and Developed by
                  <a href="https://Airland.com" rel="nofollow" target="_blank">Airland</a>
                </p>
              </div>
            </div>
          </div>
        </div>
      </footer>
      <!-- ================= Fim Footer ================= -->
    </main>
    <!-- ================= Fim Main Wrapper ================= -->

    <!-- ============ Theme Option Start ============= -->
    <button class="option-btn"><i class="lni lni-cog"></i></button>
    <div class="option-overlay"></div>
    <div class="option-box">
      <div class="option-header">
        <h5>Settings</h5>
        <button class="option-btn-close text-gray"><i class="lni lni-close"></i></button>
      </div>
      <h6 class="mb-10">Layout</h6>
      <ul class="mb-30">
        <li><button class="leftSidebarButton active">Left Sidebar</button></li>
        <li><button class="rightSidebarButton">Right Sidebar</button></li>
      </ul>
      <h6 class="mb-10">Theme</h6>
      <ul class="d-flex flex-wrap align-items-center">
        <li><button class="lightThemeButton active">Light Theme + Sidebar 1</button></li>
        <li><button class="darkThemeButton">Dark Theme + Sidebar 1</button></li>
      </ul>
    </div>
    <!-- ============ Theme Option End ============= -->

    <!-- ========= All Javascript files linkup ======== -->
    <script src="/assets/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/js/Chart.min.js"></script>
    <script src="/assets/js/apexcharts.min.js"></script>
    <script src="/assets/js/dynamic-pie-chart.js"></script>
    <script src="/assets/js/moment.min.js"></script>
    <script src="/assets/js/fullcalendar.js"></script>
    <script src="/assets/js/jvectormap.min.js"></script>
    <script src="/assets/js/world-merc.js"></script>
    <script src="/assets/js/polyfill.js"></script>
    <script src="/assets/js/quill.min.js"></script>
    <script src="/assets/js/datatable.js"></script>
    <script src="/assets/js/Sortable.min.js"></script>
    <script src="/assets/js/calendarComponent.global.js"></script>
    <script src="/assets/js/login.js" defer></script>
    <script src="/assets/js/userProfile.js" defer></script>
    <script src="/assets/js/main.js"></script>

    <script>
      // Formata data dd/mm/YYYY
      function formatDate(d) {
        const dt = new Date(d);
        return `${String(dt.getDate()).padStart(2,'0')}/` +
               `${String(dt.getMonth()+1).padStart(2,'0')}/` +
               dt.getFullYear();
      }
      // Formata moeda BRL
      function formatBRL(val) {
        return Number(val).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      }

      // Puxa ID do pedido da URL
      const pathParts = window.location.pathname.split('/');
      const pedidoId  = pathParts[pathParts.length-1];

      // Busca detalhes do pedido e dados do usuário (/api/me)
      Promise.all([
        fetch(`/api/agent/pedidos/${pedidoId}`).then(r=>r.json()),
        fetch(`/api/me`).then(r=>r.json())
      ]).then(([pedido, me]) => {
        // Header
        document.getElementById('invoiceLogo').src = me.logo_url;
        document.getElementById('dataPagamento').textContent = formatDate(pedido.data_pgto);
        document.getElementById('idPedido').textContent = pedido.id;

        // Cliente
        document.getElementById('clienteNome').textContent = pedido.nome;
        document.getElementById('clienteTelefone').textContent = pedido.telefone;
        document.getElementById('clienteEmail').textContent = pedido.email;

        // Itens na tabela
        const items = JSON.parse(pedido.pedido || '[]');
        let subtotal = 0;
        const tbody = document.getElementById('invoiceTableBody');
        items.forEach(item => {
          const totalPeople = (item.adults||0) + (item.children||0);
          const valor = (item.basePriceAdult||0)*(item.adults||0)
                      + (item.basePriceChild||0)*(item.children||0);
          subtotal += valor;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><p class="text-sm">${item.type}</p></td>
            <td><p class="text-sm">${item.hotelName} / ${item.roomName}</p></td>
            <td><p class="text-sm">${totalPeople}</p></td>
            <td><p class="text-sm">${formatBRL(valor)}</p></td>
          `;
          tbody.appendChild(tr);
        });

        // Resumo
        const descontoPercent = 5; // 5%
        const descontoValue   = subtotal * descontoPercent/100;
        const cupomValue      = 0;
        const total           = subtotal - descontoValue - cupomValue;
        document.getElementById('invoiceSummary').innerHTML = `
          <tr>
            <td colspan="3" class="text-sm text-medium">Subtotal</td>
            <td><h6 class="text-sm text-bold">${formatBRL(subtotal)}</h6></td>
          </tr>
          <tr>
            <td colspan="3" class="text-sm text-medium">Desconto</td>
            <td><h6 class="text-sm text-bold">${descontoPercent}%</h6></td>
          </tr>
          <tr>
            <td colspan="3" class="text-sm text-medium">Cupom de desconto</td>
            <td><h6 class="text-sm text-bold">-</h6></td>
          </tr>
          <tr>
            <td colspan="3"><h4>Total</h4></td>
            <td><h4>${formatBRL(total)}</h4></td>
          </tr>
        `;
      }).catch(err => {
        console.error('Erro ao carregar invoice:', err);
      });
    </script>
  </body>
</html>
